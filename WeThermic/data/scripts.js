var cssFile="style_theme_clair.css",tempBmp180,histPression,histPresMoy,pression,pSuggestedMax,pSuggestedMin,tblVentsIdx,largeurVentFull,ventTotal,ventMoyen,tblPressIdx,largeurPresFull,presTotal,presMoyen,largDouxPres,tblPresDouxIdx,tblPresFull,presDouxTotal,tblTempIdx,largeurTempFull,bmp180Total,bmp180Moyen,ctnTotal,ctnMoyen,isFullScreen,apConfigChange,attenteOK,chronoVisible,chronoRunning,chronoMaxTime,chronoDebut,chronoSepar,flagBeep,audioCtx,largeurMoyVent=180,largeurMoyTemp=180,showWind=!0,showT1=!0,showT2=!1,showPressU=!0,showPressL=!1,showPressGrid=!1,soundOn=!0,netDevURL="http://192.168.1.107",couleurVent="rgb(0, 0, 160)",couleurFillVent="rgba(0, 0, 160, 0.3)",couleurMoyVent="rgb(0, 0, 200)",couleurPression="rgb(0, 80, 120)",couleurFillPression="rgba(0, 80, 120, 0.2)",couleurMoyPres="rgb(0, 80, 80)",couleurTempBmp180="rgb(0, 150, 0)",couleurMoyBmp180="rgb(0, 127, 0)",couleurTempCtn="rgb(230, 0, 0)",couleurFillCtn="rgba(230, 0, 0, 0.2)",couleurMoyCtn="rgb(200, 30, 30)",couleurGrid="rgb(187, 229, 229)",histVentData=new Array,histVentMoy=new Array,vent=0,histTempCtn=new Array,histTCtnMoy=new Array,tempctn=0,ctnSuggestedMax=0,ctnSuggestedMin=0,histBmp180Data=new Array;histBmp180Moy=new Array,tempBmp180=0,histPression=new Array,histPresMoy=new Array,pression=0,pSuggestedMax=0,pSuggestedMin=0,tblVents=new Array(largeurMoyVent),tblVentsIdx=0,largeurVentFull=!1,ventTotal=0,ventMoyen=0,tblPress=new Array(largeurMoyVent),tblPressIdx=0,largeurPresFull=!1,presTotal=0,presMoyen=0,largDouxPres=8,tblPresDoux=new Array(largDouxPres),tblPresDouxIdx=0,tblPresFull=!1,presDouxTotal=0,tblTemp=new Array(largeurMoyTemp),tblTempIdx=0,largeurTempFull=!1,bmp180Total=0,bmp180Moyen=0,tblCtn=new Array(largeurMoyTemp),ctnTotal=0,ctnMoyen=0,isFullScreen=!1,apConfigChange=!1,attenteOK=!1,chronoVisible=!1,chronoRunning=!1,chronoMaxTime=420,chronoDebut=0,chronoSepar=":",flagBeep=!1;const notes=[261.625,293.664,329.627,349.228,391.995,440,493.883,523.251];audioCtx=new(window.AudioContext||window.webkitAudioContext||window.audioContext);function index_resize(){height=window.innerHeight,width=window.innerWidth,document.getElementById("lapage").style.height=height+"px",document.getElementById("lapage").style.width=width+"px"}async function index_onload(){var e,t,n,o,i,a,r,c,s=localStorage.getItem("cssFile");if(s!==null&&(cssFile=s),cssFile=="style_theme_sombre.css"?document.getElementById("sombre").checked=!0:document.getElementById("clair").checked=!0,loadStyle(),t=localStorage.getItem("largeurMoyVent"),t!==null&&(largeurMoyVent=Number(t)),t=localStorage.getItem("largeurMoyTemp"),t!==null&&(largeurMoyTemp=Number(t)),document.getElementById("lMoyVent").value=largeurMoyVent/60,inputLargeurVent(),document.getElementById("lMoyTemp").value=largeurMoyTemp/60,inputLargeurTemp(),e=localStorage.getItem("showWind"),e!==null&&(showWind=e==="true"),e=localStorage.getItem("showT1"),e!==null&&(showT1=e==="true"),e=localStorage.getItem("showT2"),e!==null&&(showT2=e==="true"),e=localStorage.getItem("showPressU"),e!==null&&(showPressU=e==="true"),e=localStorage.getItem("showPressL"),e!==null&&(showPressL=e==="true"),e=localStorage.getItem("showPressGrid"),e!==null&&(showPressGrid=e==="true"),document.getElementById("showWind").checked=showWind,document.getElementById("showT1").checked=showT1,document.getElementById("showT2").checked=showT2,document.getElementById("showPressU").checked=showPressU,document.getElementById("showPressL").checked=showPressL,document.getElementById("showPressGrid").checked=showPressGrid,n=localStorage.getItem("sound"),n!==null){soundOn=n==="true";const e=document.getElementById("boutonSon");soundOn?e.src="images/sound-on.svg":e.src="images/sound-off.svg"}for(height=window.innerHeight,width=window.innerWidth,document.getElementById("lapage").style.height=height+"px",document.getElementById("lapage").style.width=width+"px",XMLHttpRequest_get(location.protocol=="file:"?netDevURL+"/getversion":"/getversion"),attenteOK=!1,XMLHttpRequest_get(location.protocol=="file:"?netDevURL+"/history":"/history");!attenteOK;)await sleep(100);attenteOK=!1,ctnSuggestedMax=ctnMoyen+1.5,ctnSuggestedMin=ctnMoyen-.25,pSuggestedMax=pression+.5,pSuggestedMin=pression-.05,o={datasets:[{cubicInterpolationMode:"default",data:histVentData,fill:{target:"origin",above:couleurFillVent,below:couleurFillVent},borderColor:couleurVent,borderWidth:2,order:2,tension:.4},{cubicInterpolationMode:"default",data:histVentMoy,fill:!1,borderColor:couleurMoyVent,borderWidth:2,order:1,tension:.4},{cubicInterpolationMode:"default",data:histPression,fill:{target:"origin",above:couleurFillPression,below:couleurFillPression},borderColor:couleurPression,borderWidth:1,order:5,tension:.4,yAxisID:"y1"},{cubicInterpolationMode:"default",data:histPresMoy,fill:!1,borderColor:couleurMoyPres,borderWidth:2,order:4,tension:.4,yAxisID:"y1"}]},i={plugins:{legend:{display:!1}},elements:{point:{radius:0}},scales:{x:{type:"realtime",realtime:{duration:3e5,refresh:500,delay:250,frameRate:20,onRefresh:e=>{e.data.datasets[0].data.push({x:Date.now(),y:vent}),e.data.datasets[1].data.push({x:Date.now(),y:ventMoyen}),e.data.datasets[2].data.push({x:Date.now(),y:pression}),e.data.datasets[3].data.push({x:Date.now(),y:presMoyen})}},ticks:{display:!0},grid:{color:couleurGrid}},y:{type:"linear",beginAtZero:!0,suggestedMax:5,ticks:{color:couleurVent},grid:{color:couleurGrid}},y1:{type:"linear",beginAtZero:!1,display:!0,position:"right",suggestedMax:pSuggestedMax,suggestedMin:pSuggestedMin,ticks:{color:couleurPression},grid:{color:couleurGrid}}},responsive:!0,maintainAspectRatio:!1},a={datasets:[{cubicInterpolationMode:"default",data:histTempCtn,fill:{target:"origin",above:couleurFillCtn,below:couleurFillCtn},borderColor:couleurTempCtn,borderWidth:2,order:1,tension:.4,yAxisID:"y"},{cubicInterpolationMode:"default",data:histTCtnMoy,fill:!1,borderColor:couleurMoyCtn,borderWidth:3,order:2,tension:.4,yAxisID:"y"},{cubicInterpolationMode:"default",data:histBmp180Data,fill:!1,borderColor:couleurTempBmp180,borderWidth:2,order:3,tension:.4,yAxisID:"y"},{cubicInterpolationMode:"default",data:histBmp180Moy,fill:!1,borderColor:couleurMoyBmp180,borderWidth:3,order:4,tension:.4,yAxisID:"y"},{cubicInterpolationMode:"default",data:histPression,fill:{target:"origin",above:couleurFillPression,below:couleurFillPression},borderColor:couleurPression,borderWidth:1,order:5,tension:.4,yAxisID:"y1"},{cubicInterpolationMode:"default",data:histPresMoy,fill:!1,borderColor:couleurMoyPres,borderWidth:2,order:4,tension:.4,yAxisID:"y1"}]},r={plugins:{legend:{display:!1}},elements:{point:{radius:0}},scales:{x:{type:"realtime",realtime:{duration:3e5,refresh:500,delay:250,frameRate:50,onRefresh:e=>{e.data.datasets[0].data.push({x:Date.now(),y:tempctn}),e.data.datasets[1].data.push({x:Date.now(),y:ctnMoyen}),e.data.datasets[2].data.push({x:Date.now(),y:tempBmp180}),e.data.datasets[3].data.push({x:Date.now(),y:bmp180Moyen}),e.data.datasets[4].data.push({x:Date.now(),y:pression}),e.data.datasets[5].data.push({x:Date.now(),y:presMoyen})}},ticks:{display:!0},grid:{color:couleurGrid}},y:{type:"linear",beginAtZero:!1,display:!0,position:"left",suggestedMax:ctnSuggestedMax,suggestedMin:ctnSuggestedMin,ticks:{color:couleurTempCtn},grid:{color:couleurGrid}},y1:{type:"linear",beginAtZero:!1,display:!0,position:"right",suggestedMax:pSuggestedMax,suggestedMin:pSuggestedMin,ticks:{color:couleurPression},grid:{color:couleurGrid}}},responsive:!0,maintainAspectRatio:!1},Window.graphVent=new Chart(document.getElementById("graphVent"),{type:"line",data:o,options:i}),Window.graphTemp=new Chart(document.getElementById("graphTemp"),{type:"line",data:a,options:r}),Window.graphVent.setDatasetVisibility(0,!1),Window.graphVent.setDatasetVisibility(1,!1),Window.graphVent.setDatasetVisibility(2,!1),Window.graphTemp.setDatasetVisibility(0,!1),Window.graphTemp.setDatasetVisibility(1,!1),Window.graphTemp.setDatasetVisibility(2,!1),Window.graphTemp.setDatasetVisibility(3,!1),Window.graphTemp.setDatasetVisibility(4,!1),Window.graphTemp.setDatasetVisibility(5,!1),Window.graphTemp.update(),visuCourbes(),appliqueTheme(),location.protocol=="file:"?setTimeout(function(){XMLHttpRequest_get(netDevURL+"/getvalues")},500):setTimeout(function(){XMLHttpRequest_get("/getvalues")},500),c=document.getElementById("attente0"),c.classList.add("noshow")}function loadStyle(){var t=document.getElementsByTagName("head")[0],e=document.createElement("link");e.id="cssTheme",e.rel="stylesheet",e.type="text/css",e.href=cssFile,t.append(e)}function echelleTemperature(e){var t=document.getElementById("scaleMin"),n=document.getElementById("scaleMax");e==0?(suggestedMax=ctnMoyen+3,suggestedMin=ctnMoyen-.5):e==1?(suggestedMax=ctnMoyen+2,suggestedMin=ctnMoyen-.25):e==2?(suggestedMax=ctnMoyen+1,suggestedMin=ctnMoyen-.125):e==3?(suggestedMax=ctnMoyen,suggestedMin=ctnMoyen):e==-1&&(suggestedMax=n.value,suggestedMin=t.value),t.value=suggestedMin,n.value=suggestedMax,Window.graphTemp.options.scales.y.suggestedMax=suggestedMax,Window.graphTemp.options.scales.y.suggestedMin=suggestedMin}function recalePression(){Window.graphTemp.options.scales.y1.suggestedMax=pression+.5,Window.graphTemp.options.scales.y1.suggestedMin=pression,Window.graphTemp.update()}function XMLHttpRequest_get(e){var t,n,s=document.getElementById("heure");s!=null&&(n=new Date(Date.now()),s.textContent=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"."+n.getMilliseconds()),t=new XMLHttpRequest,t.onreadystatechange=function(){t.readyState==4&&(t.status==200||t.status==0?XMLHttpResult(e,t.responseXML,t.responseText):alert("XMLHttpRequest_get("+e+") : Error "+t.status))},t.open("GET",e,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send()}function XMLHttpResult(e,t){if(t!=null)if(e=="/getversion"||e==netDevURL+"/getversion"){var s,o,i,a,r,c,l,d,u,h=t.getElementsByTagName("string")[0].childNodes[0].nodeValue,m=document.getElementById("version");m.textContent=h}else e=="/history"||e==netDevURL+"/history"?graphHistoryintegration(t):e=="/getvalues"||e==netDevURL+"/getvalues"?(vent=Number(t.getElementsByTagName("v")[0].childNodes[0].nodeValue),calculMoyenneVent(),o=document.getElementById("valeurVent"),o.innerHTML='<span class="couleurMoyVent">moy = '+Number.parseFloat(ventMoyen).toFixed(1)+"</span>&nbsp;",o.innerHTML+='<span class="couleurVent">inst = '+Number.parseFloat(vent).toFixed(1).padStart(4," ")+" m/s</span>",i=Number(t.getElementsByTagName("c")[0].childNodes[0].nodeValue),Math.abs(i-tempctn)<3?tempctn=i:tempctn=ctnMoyen,tempBmp180=Number(t.getElementsByTagName("b")[0].childNodes[0].nodeValue),calculMoyenneTemperature(),a=document.getElementById("showT1").checked,s=document.getElementById("valeurTemp"),s.innerHTML="",showT2&&(s.innerHTML+='<span class="couleurMoyBmp180">moy = '+Number.parseFloat(bmp180Moyen).toFixed(1)+"</span>&nbsp;",s.innerHTML+='<span class="couleurTempBmp180">inst = '+Number.parseFloat(tempBmp180).toFixed(2)+"°C</span><br />"),a&&(s.innerHTML+='<span class="couleurMoyCtn">moy = '+Number.parseFloat(ctnMoyen).toFixed(1)+"</span>&nbsp;",s.innerHTML+='<span class="couleurTempCtn">inst = '+Number.parseFloat(tempctn).toFixed(2)+"°C</span>"),pression=calculPressionDouce(Number(t.getElementsByTagName("p")[0].childNodes[0].nodeValue)),calculMoyennePres(),r=document.getElementById("valeurPress"),r.innerHTML='<span class="couleurPression">'+Number.parseFloat(pression).toFixed(1)+"hPa</span>"):e=="/getnetworks"||e==netDevURL+"/getnetworks"?(setNetworkList(t),attenteOK=!0):e=="/wificonnect"?(result=t.getElementsByTagName("result")[0].childNodes[0].nodeValue,alert(result=="OK"?"Connexion OK.":`Connexion error: 
`+result)):(e=="/getapconfig"||e==netDevURL+"/getapconfig")&&(c=t.getElementsByTagName("ssid")[0].textContent,l=t.getElementsByTagName("pwd")[0].textContent,d=document.getElementById("apSSID"),u=document.getElementById("apPwd1"),d.value=c,u.value=l,apConfigChange=!1,inputConfigAP());(e=="/getvalues"||e==netDevURL+"/getvalues")&&autoRefresh()}function graphHistoryintegration(e){var t,n=!1;tX=Date.now(),tX=tX-5*60*1e3,hist=e.getElementsByTagName("h");for(const e of hist)pression=calculPressionDouce(Number(e.getElementsByTagName("p")[0].childNodes[0].nodeValue)),pression!=0&&(calculMoyennePres(),vent=Number(e.getElementsByTagName("v")[0].childNodes[0].nodeValue),calculMoyenneVent(),t=Number(e.getElementsByTagName("c")[0].childNodes[0].nodeValue),n?Math.abs(t-tempctn)<3?tempctn=t:tempctn=ctnMoyen:(tempctn=t,n=!0),tempBmp180=Number(e.getElementsByTagName("b")[0].childNodes[0].nodeValue),calculMoyenneTemperature(),histVentData.push({x:tX,y:vent}),histVentMoy.push({x:tX,y:ventMoyen}),histTempCtn.push({x:tX,y:tempctn}),histTCtnMoy.push({x:tX,y:ctnMoyen}),histBmp180Data.push({x:tX,y:tempBmp180}),histBmp180Moy.push({x:tX,y:bmp180Moyen}),histPression.push({x:tX,y:pression}),histPresMoy.push({x:tX,y:presMoyen})),tX+=500;attenteOK=!0}function autoRefresh(){location.protocol=="file:"?setTimeout(function(){XMLHttpRequest_get(netDevURL+"/getvalues")},500):setTimeout(function(){XMLHttpRequest_get("/getvalues")},500)}function calculMoyenneVent(){isNaN(tblVents[tblVentsIdx])&&(tblVents[tblVentsIdx]=0),ventTotal=ventTotal-tblVents[tblVentsIdx],tblVents[tblVentsIdx]=vent,ventTotal=ventTotal+tblVents[tblVentsIdx],tblVentsIdx=tblVentsIdx+1,tblVentsIdx>=largeurMoyVent&&(tblVentsIdx=0,largeurVentFull=!0),largeurVentFull?ventMoyen=Math.round(ventTotal/largeurMoyVent*10)/10:ventMoyen=Math.round(ventTotal/tblVentsIdx*10)/10}function calculMoyennePres(){isNaN(tblPress[tblPressIdx])&&(tblPress[tblPressIdx]=0),presTotal=presTotal-tblPress[tblPressIdx],tblPress[tblPressIdx]=pression,presTotal=presTotal+tblPress[tblPressIdx],tblPressIdx=tblPressIdx+1,tblPressIdx>=largeurMoyVent&&(tblPressIdx=0,largeurPresFull=!0),largeurVentFull?presMoyen=Math.round(presTotal/largeurMoyVent*100)/100:presMoyen=Math.round(presTotal/tblPressIdx*100)/100}function calculPressionDouce(e){var t=0;return e>0?(isNaN(tblPresDoux[tblPresDouxIdx])&&(tblPresDoux[tblPresDouxIdx]=0),presDouxTotal=presDouxTotal-tblPresDoux[tblPresDouxIdx],tblPresDoux[tblPresDouxIdx]=e,presDouxTotal=presDouxTotal+tblPresDoux[tblPresDouxIdx],tblPresDouxIdx=tblPresDouxIdx+1,tblPresDouxIdx>=largDouxPres&&(tblPresDouxIdx=0,tblPresFull=!0),tblPresFull?t=presDouxTotal/largDouxPres:t=presDouxTotal/tblPresDouxIdx,t):0}function calculMoyenneTemperature(){isNaN(tblTemp[tblTempIdx])&&(tblTemp[tblTempIdx]=0,tblCtn[tblTempIdx]=0),bmp180Total=bmp180Total-tblTemp[tblTempIdx],ctnTotal=ctnTotal-tblCtn[tblTempIdx],tblTemp[tblTempIdx]=tempBmp180,tblCtn[tblTempIdx]=tempctn,bmp180Total=bmp180Total+tblTemp[tblTempIdx],ctnTotal=ctnTotal+tblCtn[tblTempIdx],tblTempIdx=tblTempIdx+1,tblTempIdx>=largeurMoyTemp&&(tblTempIdx=0,largeurTempFull=!0),largeurTempFull?(bmp180Moyen=Math.round(bmp180Total/largeurMoyTemp*100)/100,ctnMoyen=Math.round(ctnTotal/largeurMoyTemp*100)/100):(bmp180Moyen=Math.round(bmp180Total/tblTempIdx*100)/100,ctnMoyen=Math.round(ctnTotal/tblTempIdx*100)/100)}function changeSettings(){var e,t,n,s,o=document.getElementById("settingsDialog");o.classList.remove("noshow"),t=document.getElementById("attente0"),t.classList.remove("noshow"),n=document.getElementById("scaleMin"),s=document.getElementById("scaleMax"),e=Window.graphTemp.scales.y.max,s.value=e,e=Window.graphTemp.scales.y.min,n.value=e,getAPconfig(),get_networks()}function closeSettings(){var e=document.getElementById("settingsDialog");e.classList.add("noshow")}function changeTheme(e){e=="clair"&&cssFile=="style_theme_sombre.css"?(cssFile="style_theme_clair.css",themeStyle=document.getElementById("cssTheme"),themeStyle.href=cssFile):e=="sombre"&&cssFile=="style_theme_clair.css"&&(cssFile="style_theme_sombre.css",themeStyle=document.getElementById("cssTheme"),themeStyle.href=cssFile),localStorage.setItem("cssFile",cssFile),appliqueTheme()}function appliqueTheme(){setTimeout(()=>{var e=getComputedStyle(document.body);couleurVent=e.getPropertyValue("--couleurVent"),couleurFillVent=e.getPropertyValue("--couleurFillVent"),couleurMoyVent=e.getPropertyValue("--couleurMoyVent"),couleurPression=e.getPropertyValue("--couleurPression"),couleurFillPression=e.getPropertyValue("--couleurFillPression"),couleurMoyPres=e.getPropertyValue("--couleurMoyPres"),couleurTempCtn=e.getPropertyValue("--couleurTempCtn"),couleurFillCtn=e.getPropertyValue("--couleurFillCtn"),couleurMoyCtn=e.getPropertyValue("--couleurMoyCtn"),couleurTempBmp180=e.getPropertyValue("--couleurTempBmp180"),couleurMoyBmp180=e.getPropertyValue("--couleurMoyBmp180"),couleurGrid=e.getPropertyValue("--couleurGrid"),Window.graphVent.options.scales.y.ticks.color=couleurVent,Window.graphVent.data.datasets[0].borderColor=couleurVent,Window.graphVent.data.datasets[0].fill.above=couleurFillVent,Window.graphVent.data.datasets[0].fill.below=couleurFillVent,Window.graphVent.data.datasets[1].borderColor=couleurMoyVent,Window.graphVent.options.scales.y1.ticks.color=couleurPression,Window.graphVent.data.datasets[2].borderColor=couleurPression,Window.graphVent.data.datasets[2].fill.above=couleurFillPression,Window.graphVent.data.datasets[2].fill.below=couleurFillPression,Window.graphVent.data.datasets[3].borderColor=couleurMoyPres,Window.graphVent.options.scales.x.grid.color=couleurGrid,Window.graphVent.options.scales.y.grid.color=couleurGrid,Window.graphVent.options.scales.y1.grid.color=couleurGrid,Window.graphTemp.options.scales.y.ticks.color=couleurTempCtn,Window.graphTemp.data.datasets[0].borderColor=couleurTempCtn,Window.graphTemp.data.datasets[0].fill.above=couleurFillCtn,Window.graphTemp.data.datasets[0].fill.below=couleurFillCtn,Window.graphTemp.data.datasets[1].borderColor=couleurMoyCtn,Window.graphTemp.data.datasets[2].borderColor=couleurTempBmp180,Window.graphTemp.data.datasets[3].borderColor=couleurMoyBmp180,Window.graphTemp.options.scales.y1.ticks.color=couleurPression,Window.graphTemp.data.datasets[4].borderColor=couleurPression,Window.graphTemp.data.datasets[4].fill.above=couleurFillPression,Window.graphTemp.data.datasets[4].fill.below=couleurFillPression,Window.graphTemp.options.scales.x.grid.color=couleurGrid,Window.graphTemp.options.scales.y.grid.color=couleurGrid,Window.graphTemp.options.scales.y1.grid.color=couleurGrid},500)}function visuCourbes(){newValue=document.getElementById("showWind").checked,newValue!=showWind&&(showWind=newValue,localStorage.setItem("showWind",showWind)),Window.graphVent.setDatasetVisibility(0,showWind),Window.graphVent.setDatasetVisibility(1,showWind),Window.graphVent.options.scales.y.ticks.display=showWind,Window.graphVent.options.scales.y.grid.display=showWind,newValue=document.getElementById("showPressU").checked,newValue!=showPressU&&(showPressU=newValue,localStorage.setItem("showPressU",showPressU)),Window.graphVent.setDatasetVisibility(2,showPressU),Window.graphVent.setDatasetVisibility(3,showPressU),newValue=document.getElementById("showT1").checked,newValue!=showT1&&(showT1=newValue,localStorage.setItem("showT1",showT1)),Window.graphTemp.setDatasetVisibility(0,showT1),Window.graphTemp.setDatasetVisibility(1,showT1),newValue=document.getElementById("showPressL").checked,newValue!=showPressL&&(showPressL=newValue,localStorage.setItem("showPressL",showPressL)),Window.graphTemp.setDatasetVisibility(4,showPressL),Window.graphTemp.setDatasetVisibility(5,showPressL),newValue=document.getElementById("showT2").checked,newValue!=showT2&&(showT2=newValue,localStorage.setItem("showT2",showT2.toString())),Window.graphTemp.setDatasetVisibility(2,showT2),Window.graphTemp.setDatasetVisibility(3,showT2),newValue=document.getElementById("showPressGrid").checked,newValue!=showPressGrid&&(showPressGrid=newValue,localStorage.setItem("showPressGrid",showPressGrid)),Window.graphVent.options.scales.y1.ticks.display=showPressGrid,Window.graphVent.options.scales.y1.grid.display=showPressGrid,Window.graphTemp.options.scales.y1.ticks.display=showPressGrid,Window.graphTemp.options.scales.y1.grid.display=showPressGrid}async function get_networks(){var e,t,n=document.getElementById("networkTable");for(n.innerHTML="",e=document.getElementById("ssidActuel"),e.value="",t=document.getElementById("ipActuel"),t.value="",attenteOK=!1,XMLHttpRequest_get(location.protocol=="file:"?netDevURL+"/getnetworks":"/getnetworks");!attenteOK;)await sleep(100);attenteOK=!1}function sleep(e){return new Promise(t=>setTimeout(t,e))}function setNetworkList(e){var s,o,a,u,h,m,t="",c="",r=0,n="",d="",l="",i="",f=document.getElementById("networkTable");if(t+=`  <table class="netTables">
`,t+=`    <thead>
`,t+=`      <tr>
`,t+=`        <th>&nbsp;</th>
`,t+=`        <th>SSID</th>
`,t+=`        <th>Channel</th>
`,t+=`        <th>Security</th>
`,t+=`      </tr>
`,t+=`    </thead>
`,t+=`    <tbody>
`,a=e.getElementsByTagName("activeNetwork"),a.length==1&&(u=document.getElementById("ssidActuel"),currentSSID=a[0].getElementsByTagName("SSID")[0].childNodes[0].nodeValue,u.value=currentSSID,h=document.getElementById("ipActuel"),currentIP=a[0].getElementsByTagName("localip")[0].childNodes[0].nodeValue,h.value=currentIP),o=e.getElementsByTagName("network"),o.length>0)for(s=0;s<o.length;s++)c=o[s].getElementsByTagName("SSID")[0].textContent,r=o[s].getElementsByTagName("channel")[0].textContent,n=o[s].getElementsByTagName("RSSI")[0].textContent,d=o[s].getElementsByTagName("encryption")[0].textContent,l=o[s].getElementsByTagName("knownPassword")[0].textContent,n<=-90?i="images/signal0.svg":n>-90&&n<=-80?i="images/signal1.svg":n>-80&&n<=-70?i="images/signal2.svg":n>-70&&n<=-67?i="images/signal3.svg":n>-67&&(i="images/signal4.svg"),t+=`      <tr class="trlink" onclick="wifi_connect('`+c+"', '"+r+"', '"+l.replace("'","\\'")+`')">
`,t+='        <td class="centreVertical"><img src="'+i+'" title="RSSI = '+n+`" /></td>
`,t+="        <td>"+c+`</td>
`,t+="        <td>"+r+`</td>
`,t+="        <td>"+d+`</td>
`,t+=`      </tr>
`;else t+=`      <tr>
`,t+='        <td colspan="4">No network available</td>',t+=`      </tr>
`;t+=`    </tbody>
`,t+=`  </table>
`,f.innerHTML=t,m=document.getElementById("attente0"),m.classList.add("noshow")}async function wifi_connect(e,t,n){var a="",l=document.getElementById("ssid_input"),s=document.getElementById("pwd_input"),r=document.getElementById("attente0"),o=document.getElementById("btnConnect"),i=document.getElementById("btnAnnuler");const c=document.getElementById("btnShowCliPasswd");for(s=document.getElementById("pwd_input"),s.type!=="password"&&(s.type="password",c.src="images/oeuil.svg",c.title="Show password"),l.value=e+" (ch."+t+")",s.value=n.replace("\\'","'"),connectOK=!0,suiteOK=!1,afficheDialog("dlgConnect"),o.disabled=!1,i.disabled=!1,s.focus();!suiteOK;)await sleep(100);suiteOK=!1,connectOK?(a=s.value,o.disabled=!0,i.disabled=!0,r.classList.remove("noshow"),XMLHttpRequest_post_wificonnect(e,a,t),setTimeout(function(){r.classList.add("noshow")},1e4),setTimeout(function(){closeDialog("dlgConnect")},1e4)):(closeDialog("dlgConnect"),o.disabled=!1,i.disabled=!1,s.value="")}function afficheDialog(e){var t=document.getElementById("dlgMask0"),n=document.getElementById(e);t.classList.remove("noshow"),window.setTimeout(function(){n.classList.remove("masquer")},.2)}function closeDialog(e){var t=document.getElementById("dlgMask0"),n=document.getElementById(e);n.classList.add("masquer"),window.setTimeout(function(){t.classList.add("noshow")},1)}function connect_clique(){connectOK=!0,suiteOK=!0,get_networks()}function connect_cancel(){connectOK=!1,suiteOK=!0}function connect_keyup(e){e.keyCode===13?document.getElementById("btnConnect").click():e.keyCode===27&&document.getElementById("btnAnnuler").click()}function XMLHttpRequest_post_wificonnect(e,t,n){var o,i,s=new XMLHttpRequest;s.onreadystatechange=function(){s.readyState==4&&(s.status==200||s.status==0?XMLHttpResult("/wificonnect",s.responseXML,s.responseText):alert("XMLHttpRequest_post_wificonnect() : Error "+s.status))},o=encodeURIComponent(e),i=encodeURIComponent(t),location.protocol=="file:"?s.open("POST",netDevURL+"/wificonnect",!0):s.open("POST","/wificonnect",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send("ssid="+o+"&pwd="+i+"&channel="+n)}function deconnect_clique(){var e="",e=`Do you really want to disconnect from the current network
and clear the client WiFi settings in the balance?`;confirm(e)&&XMLHttpRequest_get("deconnexion"),get_networks()}function toggleFullscreen(){bouton=document.getElementById("fullScreenButton"),isFullScreen?(closeFullscreen(),isFullScreen=!1,bouton.innerHTML="<br />View in full screen<br />&nbsp;"):(openFullscreen(),isFullScreen=!0,bouton.innerHTML="<br />Close full screen<br />&nbsp;"),window.scrollTo(0,0)}function openFullscreen(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function closeFullscreen(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function fullscreenchanged(){height=window.innerHeight,width=window.innerWidth,document.getElementById("lapage").style.height=height+"px",document.getElementById("lapage").style.width=width+"px"}document.addEventListener("fullscreenchange",fullscreenchanged);function inputLargeurVent(){var e=document.getElementById("valMoyVent"),t=document.getElementById("lMoyVent").value;secondes=t*30,e.innerText=new Date(secondes*1e3).toISOString().substring(15,19)}function changeLargeurVent(){var e=document.getElementById("lMoyVent").value;largeurMoyVent=e*60,delete tblVents,tblVents=new Array(largeurMoyVent),tblVentsIdx=0,ventTotal=0,ventMoyen=0,Window.graphVent.data.datasets[1].data=[],localStorage.setItem("largeurMoyVent",largeurMoyVent)}function inputLargeurTemp(){var e=document.getElementById("valMoyTemp"),t=document.getElementById("lMoyTemp").value;secondes=t*30,e.innerText=new Date(secondes*1e3).toISOString().substring(15,19)}function changeLargeurTemp(){var e=document.getElementById("lMoyTemp").value;largeurMoyTemp=e*60,delete tblTemp,tblTemp=new Array(largeurMoyTemp),tblTempIdx=0,largeurTempFull=!1,bmp180Total=0,bmp180Moyen=0,delete tblCtn,tblCtn=new Array(largeurMoyTemp),ctnTotal=0,ctnMoyen=0,Window.graphTemp.data.datasets[1].data=[],Window.graphTemp.data.datasets[3].data=[],localStorage.setItem("largeurMoyTemp",largeurMoyTemp)}function getAPconfig(){XMLHttpRequest_get(location.protocol=="file:"?netDevURL+"/getapconfig":"/getapconfig")}function toogleShowPasswd(e){if(e=="ap"){const e=document.getElementById("btnShowPasswd");var t,n=document.getElementById("apPwd1"),s=document.getElementById("apPwd2");n.type==="password"?(n.type="text",s.type="text",e.src="images/oeuil-barre.svg",e.title="Hide password"):(n.type="password",s.type="password",e.src="images/oeuil.svg",e.title="Show password")}else{const e=document.getElementById("btnShowCliPasswd");t=document.getElementById("pwd_input"),t.type==="password"?(t.type="text",e.src="images/oeuil-barre.svg",e.title="Hide password"):(t.type="password",e.src="images/oeuil.svg",e.title="Show password")}}function inputConfigAP(){var s=document.getElementById("apSSID"),t=document.getElementById("apPwd1"),n=document.getElementById("apPwd2"),e=document.getElementById("btnValideAP");t.value==n.value&&(t.value.length==0||t.value.length>=8)&&apConfigChange?(e.src="images/valid.svg",e.style.cursor="pointer"):(e.src="images/valid-disable.svg",e.style.cursor="default")}function updateAPconfig(){var e,n,s,o=document.getElementById("apSSID"),t=document.getElementById("apPwd1"),i=document.getElementById("apPwd2");t.value==i.value&&(t.value.length==0||t.value.length>=8)&&apConfigChange?(e=new XMLHttpRequest,e.onreadystatechange=function(){e.readyState==4&&alert(e.status==200||e.status==0?`updateAPconfig():
`+e.responseText:"updateAPconfig() : Error "+e.status)},n=encodeURIComponent(o.value),s=encodeURIComponent(t.value),location.protocol=="file:"?e.open("POST",netDevURL+"/setapconfig",!0):e.open("POST","/setapconfig",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("ssid="+n+"&pwd="+s)):alert("Entered passwords are not identical!")}function resetSettings(){confirm("Reset preferences to default?")==!0&&(localStorage.clear(),window.location.reload())}function reboot(){confirm("Reboot the weather station?")==!0&&XMLHttpRequest_get(location.protocol=="file:"?netDevURL+"/reboot":"/reboot")}function toggleChrono(){var e=document.getElementById("cadre_chrono"),t=document.getElementById("boutonSon");chronoVisible?(e.classList.add("noshow"),t.classList.add("noshow"),chronoVisible=!1):(e.classList.remove("noshow"),t.classList.remove("noshow"),chronoVisible=!0)}function startStopChrono(){var e=document.getElementById("chrono0");const t=document.getElementById("btnChrono");chronoRunning?confirm("Stopping time countdown?")==!0&&(chronoRunning=!1,e=document.getElementById("chrono0"),minutes=Math.trunc(chronoMaxTime/60),seconds=chronoMaxTime%60,newText=minutes.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+":"+seconds.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),e.innerHTML=newText,t.src="images/start-chrono.svg"):(chronoRunning=!0,chronoDebut=Date.now(),t.src="images/stop-chrono.svg",refreshChrono(),clignottementChrono(),soundOn&&beep(500,notes[0],2,"sine",function(){flagBeep=!1}))}function refreshChrono(){var e,t=document.getElementById("chrono0");if(chronoRunning){if(e=chronoMaxTime*1e3-(Date.now()-chronoDebut),e>0)minutes=Math.trunc(e/6e4),seconds=Math.floor(e%6e4/1e3),newText=minutes.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1})+chronoSepar+seconds.toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1}),t.innerHTML=newText,seconds==0&&soundOn&&(flagBeep||(flagBeep=!0,minutes==0?duree=1e3:duree=500,beep(duree,notes[7-minutes],2,"sine",function(){flagBeep=!1})));else{t.innerHTML="00:00",chronoRunning=!1;const e=document.getElementById("btnChrono");e.src="images/start-chrono.svg"}setTimeout(function(){refreshChrono()},500)}else t.innerHTML="07:00"}function clignottementChrono(){chronoSepar==":"?chronoSepar="&nbsp;":chronoSepar=":",chronoRunning?setTimeout(function(){clignottementChrono()},500):chronoSepar=":"}function beep(e,t,n,s,o){var i=audioCtx.createOscillator(),a=audioCtx.createGain();i.connect(a),a.connect(audioCtx.destination),n&&(a.gain.value=n),t&&(i.frequency.value=t),s&&(i.type=s),o&&(i.onended=o),e?duree=e/1e3:duree=.5,i.start(audioCtx.currentTime),i.stop(audioCtx.currentTime+duree)}function toggleSon(){const e=document.getElementById("boutonSon");soundOn?(e.src="images/sound-off.svg",soundOn=!1,localStorage.setItem("sound",soundOn)):(e.src="images/sound-on.svg",soundOn=!0,localStorage.setItem("sound",soundOn))}function wakeup(){XMLHttpRequest_get(location.protocol=="file:"?netDevURL+"/wakeup":"/wakeup")}